# Documentation Enforcer v2 Skill

> 文档规范执行器 - 自动化文档管理和命名规范 + 单一真相源强制执行

## 🎯 目标

强制执行文档规范，防止文档混乱，确保每次会话都遵循统一的文档管理规则。

**v2 新增功能**：
- ✅ 禁止创建孤立文档
- ✅ 强制关联到主文档
- ✅ 自动一致性检查
- ✅ 与 requirement-sync-manager 协作

---

## 📋 核心规则

### 规则 1: 会话开始时必须做的事

**每次会话开始时，AI 必须**:

1. **读取最近的进度**
   ```bash
   # 读取这些文件了解上下文
   - docs/progress.md
   - docs/task_plan.md
   - docs/findings.md
   ```

2. **检查今天的工作日志是否存在**
   ```bash
   # 检查文件是否存在
   docs/开发日志/YYYY-MM-DD-工作日志.md

   # 如果不存在，立即创建
   ```

3. **向用户确认今天的工作目标**
   ```
   今天的工作目标是什么？
   - [ ] 目标1
   - [ ] 目标2
   ```

---

### 规则 2: 会话结束时必须做的事

**每次会话结束前，AI 必须**:

1. **更新今天的工作日志**
   ```markdown
   # 文件: docs/开发日志/YYYY-MM-DD-工作日志.md

   ## 会话时间
   开始: HH:mm
   结束: HH:mm

   ## 今日目标
   - [x] 完成的目标
   - [ ] 未完成的目标

   ## 完成的工作
   1. 具体工作1
   2. 具体工作2

   ## 修改的文件
   - `文件路径` - 修改说明

   ## 遇到的问题
   - 问题描述
   - 解决方案

   ## 测试结果
   - 测试项目
   - 测试结果

   ## 明天计划
   - 计划1
   - 计划2
   ```

2. **更新 progress.md**
   ```markdown
   # 在文件开头添加新记录
   ## YYYY-MM-DD HH:mm - 会话摘要

   ### 完成的工作
   - 工作1
   - 工作2

   ### 下一步
   - 计划1
   ```

3. **更新 task_plan.md**
   ```markdown
   # 更新任务状态
   - 标记完成的任务为 [completed]
   - 添加新发现的任务
   ```

4. **如果有重要发现，更新 findings.md**
   ```markdown
   ## YYYY-MM-DD - 问题标题

   ### 问题描述
   [描述]

   ### 根本原因
   [原因]

   ### 解决方案
   [方案]
   ```

---

### 规则 3: 文档命名规范

#### 开发日志
**位置**: `docs/03-开发日志/`

**命名格式**: `YYYY-MM-DD-工作日志.md`

**示例**:
- ✅ `2026-02-15-工作日志.md`
- ❌ `工作日志_2026-02-15.md`
- ❌ `work-log.md`

#### 测试文档
**位置**: `docs/04-测试文档/`

**命名格式**: `YYYY-MM-DD-测试名称.md`

**示例**:
- ✅ `2026-02-15-匹配算法测试.md`
- ✅ `2026-02-15-E2E测试结果.md`
- ❌ `test_results.md`

#### 架构文档
**位置**: `docs/02-架构设计/`

**命名格式**: `主题-版本.md` 或 `主题-YYYY-MM-DD.md`

**示例**:
- ✅ `JD匹配系统-完整设计文档-v2.0.md`
- ✅ `评分体系设计-2026-02-14.md`
- ❌ `architecture.md`

#### 问题排查文档
**位置**: `docs/05-问题排查/`

**命名格式**: `问题描述-YYYY-MM-DD.md`

**示例**:
- ✅ `评分逻辑问题分析-2026-02-14.md`
- ✅ `简历解析系统重构方案-2026-02-15.md`
- ❌ `bug_fix.md`

#### ADR（架构决策记录）
**位置**: `docs/architecture/`

**命名格式**: `ADR-NNN-决策标题.md`

**示例**:
- ✅ `ADR-001-匹配算法设计.md`
- ✅ `ADR-002-数据提取逻辑.md`
- ❌ `decision.md`

#### 变更日志
**位置**: `docs/changelog/`

**命名格式**: `YYYY-MM.md`

**示例**:
- ✅ `2026-02.md`
- ❌ `changelog.md`

---

### 规则 4: 禁止的文档操作

#### ❌ 绝对禁止

1. **在根目录创建文档**
   ```
   ❌ /project-root/work-log.md
   ✅ /project-root/docs/03-开发日志/2026-02-15-工作日志.md
   ```

2. **使用不规范的命名**
   ```
   ❌ test.md
   ❌ 新建文档.md
   ❌ temp_notes.md
   ❌ 文档1.md
   ```

3. **创建重复的文档**
   ```
   ❌ 同时存在 work-log.md 和 工作日志.md
   ❌ 同时存在 test_results.md 和 测试结果.md
   ```

4. **在错误的位置创建文档**
   ```
   ❌ 测试文档放在 02-架构设计/
   ❌ 工作日志放在 04-测试文档/
   ```

---

### 规则 5: 文档内容规范

#### 每个文档必须包含的元信息

```markdown
# 文档标题

**创建日期**: YYYY-MM-DD
**最后更新**: YYYY-MM-DD
**作者**: Claude Code
**状态**: [草稿/进行中/已完成/已归档]

---

[文档内容]
```

#### 工作日志模板

```markdown
# YYYY-MM-DD 工作日志

**日期**: YYYY-MM-DD
**会话时间**: HH:mm - HH:mm

---

## 📋 今日目标

- [ ] 目标1
- [ ] 目标2
- [ ] 目标3

---

## ✅ 完成的工作

### 1. 工作项1
**时间**: HH:mm - HH:mm
**描述**: [详细描述]
**修改文件**:
- `文件路径` - 修改说明

### 2. 工作项2
**时间**: HH:mm - HH:mm
**描述**: [详细描述]

---

## 🧪 测试记录

### 测试1: [测试名称]
**时间**: HH:mm
**结果**: ✅ 通过 / ❌ 失败
**详情**: [测试详情]

---

## 🐛 遇到的问题

### 问题1: [问题标题]
**发现时间**: HH:mm
**问题描述**: [描述]
**根本原因**: [原因]
**解决方案**: [方案]
**解决时间**: HH:mm
**状态**: ✅ 已解决 / 🔄 进行中 / ⏸️ 待处理

---

## 💡 重要发现

- 发现1
- 发现2

---

## 📊 技术决策

### 决策1: [决策标题]
**背景**: [为什么需要做这个决策]
**选项**:
- 选项A: [优缺点]
- 选项B: [优缺点]
**最终决策**: [选择的方案]
**理由**: [为什么选择这个方案]

---

## 📝 明天计划

- [ ] 计划1
- [ ] 计划2
- [ ] 计划3

---

## 📎 相关文档

- [相关文档1](路径)
- [相关文档2](路径)
```

#### 测试文档模板

```markdown
# YYYY-MM-DD [测试名称]

**测试日期**: YYYY-MM-DD
**测试人员**: Claude Code
**测试类型**: [单元测试/集成测试/E2E测试/性能测试]
**测试状态**: ✅ 通过 / ❌ 失败 / 🔄 进行中

---

## 测试目标

[描述测试要验证什么]

---

## 测试环境

- **Node 版本**: vX.X.X
- **数据库**: [数据库信息]
- **测试数据**: [测试数据说明]

---

## 测试用例

### 用例1: [用例名称]
**输入**: [输入数据]
**预期输出**: [预期结果]
**实际输出**: [实际结果]
**状态**: ✅ 通过 / ❌ 失败

### 用例2: [用例名称]
[同上]

---

## 测试结果汇总

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 测试1  | ✅   | -    |
| 测试2  | ❌   | [问题描述] |

---

## 发现的问题

### 问题1: [问题标题]
**严重程度**: 🔴 高 / 🟡 中 / 🟢 低
**问题描述**: [描述]
**复现步骤**: [步骤]
**解决方案**: [方案]

---

## 改进建议

- 建议1
- 建议2

---

## 相关文档

- [相关文档1](路径)
```

---

## 🤖 AI 执行流程

### 会话开始时

```
1. 读取 docs/progress.md
2. 读取 docs/task_plan.md
3. 读取 docs/findings.md
4. 检查今天的工作日志是否存在
   - 如果不存在，创建 docs/03-开发日志/YYYY-MM-DD-工作日志.md
5. 向用户确认今天的工作目标
```

### 创建文档时

```
1. 确定文档类型（开发日志/测试/架构/问题排查）
2. 确定文档位置（对应的 docs/ 子文件夹）
3. 使用规范的命名格式
4. 使用对应的文档模板
5. 填写元信息（日期、作者、状态）
```

### 会话结束时

```
1. 更新今天的工作日志
   - 完成的工作
   - 修改的文件
   - 遇到的问题
   - 测试结果
   - 明天计划
2. 更新 docs/progress.md（在开头添加新记录）
3. 更新 docs/task_plan.md（更新任务状态）
4. 如果有重要发现，更新 docs/findings.md
5. 提醒用户查看今天的工作日志
```

---

## 🔍 文档检查清单

### 每次创建文档前检查

- [ ] 文档类型正确？
- [ ] 文档位置正确？
- [ ] 文件命名符合规范？
- [ ] 包含必要的元信息？
- [ ] 使用了正确的模板？
- [ ] 没有在根目录创建文档？

### 每次会话结束前检查

- [ ] 今天的工作日志已更新？
- [ ] progress.md 已更新？
- [ ] task_plan.md 已更新？
- [ ] findings.md 已更新（如有需要）？
- [ ] 所有文档都在正确的位置？
- [ ] 所有文档命名都符合规范？

---

## 📊 文档结构总览

```
docs/
├── 00-README.md                    # 文档导航
├── 架构设计/                       # 架构、设计、ADR
│   ├── [主题]-v[版本].md
│   ├── ADR-NNN-[决策标题].md
│   └── [主题]-YYYY-MM-DD.md
├── 开发日志/                       # 每日工作日志、变更日志
│   ├── YYYY-MM-DD-工作日志.md     # 必须按日期命名
│   ├── YYYY-MM.md                 # 月度变更日志
│   └── ...
├── 测试文档/                       # 测试记录
│   ├── YYYY-MM-DD-[测试名称].md
│   └── ...
├── 问题排查/                       # 问题分析、定位指南
│   ├── [问题描述]-YYYY-MM-DD.md
│   └── ...
├── findings.md                     # 问题和解决方案汇总
├── progress.md                     # 会话日志（按时间倒序）
├── task_plan.md                    # 任务追踪
└── 规范化流程设计文档.md           # 开发流程规范
```

---

## ⚠️ 常见错误和纠正

### 错误 1: 在根目录创建文档

```
❌ 错误:
/project-root/work-log.md

✅ 正确:
/project-root/docs/03-开发日志/2026-02-15-工作日志.md
```

### 错误 2: 命名不规范

```
❌ 错误:
test.md
新建文档.md
temp_notes.md

✅ 正确:
2026-02-15-匹配算法测试.md
2026-02-15-工作日志.md
评分体系设计-2026-02-14.md
```

### 错误 3: 文档位置错误

```
❌ 错误:
docs/02-架构设计/2026-02-15-测试结果.md

✅ 正确:
docs/04-测试文档/2026-02-15-测试结果.md
```

### 错误 4: 没有更新工作日志

```
❌ 错误:
会话结束时没有更新今天的工作日志

✅ 正确:
每次会话结束前必须更新 docs/03-开发日志/YYYY-MM-DD-工作日志.md
```

---

## 🎯 执行优先级

### P0（必须执行）
1. 会话开始时读取上下文
2. 会话开始时检查/创建今天的工作日志
3. 会话结束时更新今天的工作日志
4. 所有文档必须使用规范命名
5. 所有文档必须放在正确位置

### P1（强烈建议）
1. 会话结束时更新 progress.md
2. 会话结束时更新 task_plan.md
3. 重要发现更新 findings.md
4. 使用文档模板

### P2（建议）
1. 文档包含完整的元信息
2. 定期归档旧文档

---

## 📝 使用示例

### 示例 1: 会话开始

```
AI: [自动执行]
1. 读取 docs/progress.md
2. 读取 docs/task_plan.md
3. 检查 docs/03-开发日志/2026-02-15-工作日志.md
   - 不存在，创建新文件
4. 向用户确认:

"今天的工作目标是什么？
- [ ] 目标1
- [ ] 目标2"
```

### 示例 2: 创建测试文档

```
用户: "帮我测试一下匹配算法"

AI: [自动执行]
1. 确定文档类型: 测试文档
2. 确定位置: docs/04-测试文档/
3. 确定命名: 2026-02-15-匹配算法测试.md
4. 使用测试文档模板
5. 创建文档并记录测试结果
```

### 示例 3: 会话结束

```
AI: [自动执行]
1. 更新 docs/03-开发日志/2026-02-15-工作日志.md
   - 完成的工作
   - 修改的文件
   - 遇到的问题
   - 测试结果
   - 明天计划
2. 更新 docs/progress.md（在开头添加）
3. 更新 docs/task_plan.md
4. 提醒用户:

"✅ 今天的工作日志已更新: docs/03-开发日志/2026-02-15-工作日志.md

今日完成:
- 工作1
- 工作2

明天计划:
- 计划1
- 计划2"
```

---

## 🔗 相关文档

- `.claude/CLAUDE.md` - 项目规则
- `docs/00-README.md` - 文档导航
- `docs/规范化流程设计文档.md` - 开发流程规范

---

**Skill 版本**: v1.0
**创建日期**: 2026-02-15
**最后更新**: 2026-02-15

---

## 🆕 v2 新增功能

### 规则 5: 禁止创建孤立文档（v2）

**触发条件**：
当 AI 想要创建新文档时，必须先检查：

1. **这是需求相关的文档吗？**
   - 如果是 → 必须更新 `docs/01-需求文档/PRD-主文档.md`
   - 不允许创建独立的需求文档

2. **这是测试相关的文档吗？**
   - 如果是 → 必须关联到测试用例库
   - 不允许创建孤立的测试文档

3. **这是架构决策吗？**
   - 如果是 → 必须创建 ADR 文档
   - 必须关联到主架构文档

**拦截流程**：
```
AI 想创建新文档
  ↓
documentation-enforcer-v2 拦截
  ↓
检查文档类型
  ├─ 需求文档 → 调用 requirement-sync-manager
  ├─ 测试文档 → 调用 test-case-sync-engine
  ├─ 架构文档 → 检查是否需要 ADR
  └─ 其他文档 → 检查命名规范
  ↓
通过检查后才允许创建
```

---

### 规则 6: 强制文档关联（v2）

**所有文档必须关联到主文档**：

1. **需求变更文档**
   ```markdown
   # 文件头部必须包含
   **关联 PRD**: [PRD-主文档.md](../PRD-主文档.md#章节)
   **PRD 版本**: v2.1
   ```

2. **测试文档**
   ```markdown
   # 文件头部必须包含
   **测试用例**: TEST-001, TEST-002
   **关联需求**: [PRD-主文档.md](../../01-需求文档/PRD-主文档.md#功能)
   ```

3. **问题排查文档**
   ```markdown
   # 文件头部必须包含
   **关联需求**: [PRD-主文档.md](../../01-需求文档/PRD-主文档.md#功能)
   **关联测试**: [测试文档](../../04-测试文档/YYYY-MM-DD-测试.md)
   ```

---

### 规则 7: 自动一致性检查（v2）

**定期检查（每次会话结束时）**：

1. **检查 PRD 和测试用例是否同步**
   ```
   读取 PRD-主文档.md
     ↓
   提取所有需求和验收标准
     ↓
   读取 test-cases-master.json
     ↓
   检查每个需求是否有对应的测试用例
     ↓
   如果发现不一致 → 提醒用户
   ```

2. **检查文档关联完整性**
   ```
   扫描所有文档
     ↓
   检查是否有孤立文档（没有关联到主文档）
     ↓
   如果发现孤立文档 → 警告用户
   ```

3. **检查版本号一致性**
   ```
   检查 PRD-主文档.md 的版本号
     ↓
   检查所有变更记录的版本号
     ↓
   检查 test-cases-master.json 的版本号
     ↓
   如果发现不一致 → 提醒用户
   ```

**检查报告格式**：
```markdown
## 文档一致性检查报告

**检查时间**: YYYY-MM-DD HH:mm

### ✅ 通过检查
- PRD 版本号一致
- 所有需求都有测试用例
- 无孤立文档

### ⚠️ 发现问题
1. 需求 "匹配度百分比显示" 缺少测试用例
2. 文档 "docs/临时笔记.md" 未关联到主文档
3. PRD 版本 v2.1，但 test-cases 版本仍为 v2.0

### 🔧 建议操作
- 为需求 "匹配度百分比显示" 创建测试用例
- 删除或关联 "docs/临时笔记.md"
- 更新 test-cases-master.json 版本号
```

---

## 🤝 与其他 Skills 的协作

### 1. requirement-sync-manager
- 需求变更时自动调用
- 确保 PRD 主文档更新

### 2. test-case-sync-engine
- 测试用例变更时自动调用
- 确保测试用例关联到需求

### 3. doc-coauthoring
- 创建新文档时使用
- 提供结构化的文档创建流程

---

**Skill Version**: v2.0
**Upgraded**: 2026-02-15
**Compatibility**: Claude Code 2.0+
